{% extends "base.html" %}

{% block title %}Pending Lottery Data Extractions{% endblock %}

{% block styles %}
{{ super() }}
<style>
    .extraction-card {
        border: 1px solid #dee2e6;
        border-radius: 0.25rem;
        padding: 1rem;
        margin-bottom: 1rem;
        background-color: #f8f9fa;
        box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075);
        transition: all 0.3s ease;
    }
    
    .extraction-card:hover {
        box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.15);
        transform: translateY(-2px);
    }
    
    .extraction-card .badge {
        font-size: 0.8rem;
    }
    
    .number-badge {
        display: inline-block;
        min-width: 2rem;
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
        font-weight: 600;
        line-height: 1;
        text-align: center;
        white-space: nowrap;
        vertical-align: baseline;
        border-radius: 0.25rem;
        margin: 0.125rem;
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
    }
    
    .bonus-badge {
        background-color: #ffc107;
        color: #212529;
    }
    
    .action-btn {
        margin-top: 1rem;
    }
    
    .empty-state {
        text-align: center;
        padding: 3rem 0;
        color: #6c757d;
    }
    
    .empty-state i {
        font-size: 3rem;
        margin-bottom: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-4">
    <div class="row mb-4">
        <div class="col">
            <h1>Pending Lottery Extractions</h1>
            <p class="text-muted">Review and approve lottery data extracted from screenshots</p>
        </div>
        <div class="col-auto">
            <a href="{{ url_for('automated_extraction.run_extraction_now') }}" class="btn btn-primary">
                <i class="fas fa-sync-alt"></i> Run Extraction Now
            </a>
        </div>
    </div>
    
    {% if pending_extractions %}
        <div class="row">
            {% for extraction in pending_extractions %}
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="extraction-card">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h5 class="mb-0">{{ extraction.lottery_type }}</h5>
                        <span class="badge bg-primary">Draw #{{ extraction.draw_number }}</span>
                    </div>
                    
                    <p class="mb-1"><strong>Date:</strong> {{ extraction.data.draw_date }}</p>
                    
                    <div class="mb-2">
                        <strong>Numbers:</strong><br>
                        {% for number in extraction.data.winning_numbers %}
                            <span class="number-badge">{{ number }}</span>
                        {% endfor %}
                        
                        {% if extraction.data.bonus_numbers and extraction.data.bonus_numbers|length > 0 %}
                            <div class="mt-1">
                                <strong>Bonus:</strong><br>
                                {% for number in extraction.data.bonus_numbers %}
                                    <span class="number-badge bonus-badge">{{ number }}</span>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <p class="mb-1 text-muted small">Extracted: {{ extraction.extraction_date }}</p>
                    
                    <div class="d-flex mt-3">
                        <a href="{{ url_for('automated_extraction.extraction_details', extraction_id=extraction.id) }}" class="btn btn-outline-primary btn-sm me-2">
                            <i class="fas fa-eye"></i> View Details
                        </a>
                        
                        <form action="{{ url_for('automated_extraction.approve_extraction', extraction_id=extraction.id) }}" method="POST" class="me-2">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-success btn-sm">
                                <i class="fas fa-check"></i> Approve
                            </button>
                        </form>
                        
                        <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#rejectModal{{ extraction.id }}">
                            <i class="fas fa-times"></i> Reject
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Reject Modal -->
            <div class="modal fade" id="rejectModal{{ extraction.id }}" tabindex="-1" aria-labelledby="rejectModalLabel{{ extraction.id }}" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="rejectModalLabel{{ extraction.id }}">Reject Extraction</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <form action="{{ url_for('automated_extraction.reject_extraction', extraction_id=extraction.id) }}" method="POST">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <div class="modal-body">
                                <p>Are you sure you want to reject this extraction for {{ extraction.lottery_type }} Draw #{{ extraction.draw_number }}?</p>
                                <div class="mb-3">
                                    <label for="rejection_reason" class="form-label">Reason for rejection (optional):</label>
                                    <textarea class="form-control" id="rejection_reason" name="rejection_reason" rows="3"></textarea>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-danger">Reject</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <i class="fas fa-clipboard-list"></i>
            <h3>No Pending Extractions</h3>
            <p>There are no lottery data extractions waiting for review.</p>
            <a href="{{ url_for('automated_extraction.run_extraction_now') }}" class="btn btn-primary mt-3">
                <i class="fas fa-sync-alt"></i> Run Extraction Now
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add any JavaScript for the page here
    });
</script>
{% endblock %}