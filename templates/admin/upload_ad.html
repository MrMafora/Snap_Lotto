{% extends "base.html" %}

{% block title %}Upload Advertisement | Snap Lotto{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>
            <i class="fas fa-upload me-2"></i> Upload Advertisement
        </h1>
        <div>
            <a href="{{ url_for('ad_management.manage_ads') }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i> Back to Ads
            </a>
        </div>
    </div>
    
    <div class="card shadow-sm">
        <div class="card-body">
            <form action="{{ url_for('ad_management.upload_ad') }}" method="post" enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                
                <div class="row">
                    <div class="col-md-8">
                        <!-- Basic Information -->
                        <h5 class="mb-3">Advertisement Details</h5>
                        
                        <div class="mb-3">
                            <label for="name" class="form-label">Advertisement Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="name" name="name" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control" id="description" name="description" rows="3"></textarea>
                            <div class="form-text">A brief description of the advertisement</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="placement" class="form-label">Placement <span class="text-danger">*</span></label>
                            <select class="form-select" id="placement" name="placement" required>
                                <option value="scanner">Scanner (During Ticket Scanning)</option>
                                <option value="results">Results (On Results Page)</option>
                                <option value="header">Header (Top of Site)</option>
                            </select>
                            <div class="form-text">Where the advertisement will appear</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="duration" class="form-label">Duration (seconds) <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" id="duration" name="duration" min="5" max="60" value="15" required>
                            <div class="form-text">How long the advertisement will play (5-60 seconds)</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="campaign_id" class="form-label">Campaign</label>
                            <select class="form-select" id="campaign_id" name="campaign_id">
                                <option value="">No Campaign (Standalone Ad)</option>
                                {% for campaign in campaigns %}
                                    <option value="{{ campaign.id }}">{{ campaign.name }}</option>
                                {% endfor %}
                            </select>
                            <div class="form-text">Optionally assign to a campaign for grouped analytics</div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <!-- File Upload -->
                        <h5 class="mb-3">Advertisement Media</h5>
                        
                        <div class="mb-4">
                            <label for="ad_file" class="form-label">Upload File <span class="text-danger">*</span></label>
                            <input type="file" class="form-control" id="ad_file" name="ad_file" accept="video/mp4,video/webm,image/png,image/jpeg,image/gif" required>
                            <div class="form-text">
                                Accepted formats: MP4, WebM, PNG, JPEG, GIF<br>
                                Maximum file size: 20MB
                            </div>
                        </div>
                        
                        <div class="card bg-light mb-4">
                            <div class="card-body">
                                <h6 class="card-title"><i class="fas fa-info-circle me-2 text-primary"></i> File Recommendations</h6>
                                <ul class="small mb-0">
                                    <li>Video: MP4 format, 16:9 aspect ratio</li>
                                    <li>Image: High-resolution PNG or JPEG</li>
                                    <li>Animation: GIF with high frame rate</li>
                                    <li>Keep file sizes under 10MB for optimal loading</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="card bg-light">
                            <div class="card-body">
                                <h6 class="card-title"><i class="fas fa-exclamation-triangle me-2 text-warning"></i> Important Notice</h6>
                                <p class="small mb-0">Ensure you have the rights to use any content uploaded. Advertisements must comply with our content guidelines and relevant advertising regulations.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Advanced Options (collapsible) -->
                <div class="mb-4 mt-3">
                    <a class="btn btn-outline-secondary mb-3" data-bs-toggle="collapse" href="#advancedOptions" role="button" aria-expanded="false" aria-controls="advancedOptions">
                        <i class="fas fa-cog me-2"></i> Advanced Options
                    </a>
                    
                    <div class="collapse" id="advancedOptions">
                        <div class="card card-body bg-light">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="mb-3">Scheduling</h6>
                                    
                                    <div class="mb-3">
                                        <label for="start_date" class="form-label">Start Date</label>
                                        <input type="date" class="form-control" id="start_date" name="start_date">
                                        <div class="form-text">When to start showing this advertisement</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="end_date" class="form-label">End Date</label>
                                        <input type="date" class="form-control" id="end_date" name="end_date">
                                        <div class="form-text">When to stop showing this advertisement</div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <h6 class="mb-3">Loading Overlay</h6>
                                    
                                    <div class="mb-3">
                                        <label for="custom_message" class="form-label">Custom Message</label>
                                        <input type="text" class="form-control" id="custom_message" name="custom_message">
                                        <div class="form-text">Custom message to display during loading</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="loading_duration" class="form-label">Loading Duration (seconds)</label>
                                        <input type="number" class="form-control" id="loading_duration" name="loading_duration" min="3" max="15" value="10">
                                        <div class="form-text">How long to show the loading overlay (3-15 seconds)</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="text-end">
                    <button type="button" class="btn btn-outline-secondary me-2" onclick="window.location.href='{{ url_for('ad_management.manage_ads') }}'">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i> Upload Advertisement
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    // Preview file upload
    document.getElementById('ad_file').addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            if (file.size > 20 * 1024 * 1024) {
                alert('File is too large. Maximum file size is 20MB.');
                this.value = '';
            }
        }
    });
    
    // Handle date validation
    const startDateInput = document.getElementById('start_date');
    const endDateInput = document.getElementById('end_date');
    
    endDateInput.addEventListener('change', function() {
        const startDate = new Date(startDateInput.value);
        const endDate = new Date(endDateInput.value);
        
        if (startDate > endDate) {
            alert('End date cannot be earlier than start date');
            endDateInput.value = '';
        }
    });
    
    startDateInput.addEventListener('change', function() {
        if (endDateInput.value) {
            const startDate = new Date(startDateInput.value);
            const endDate = new Date(endDateInput.value);
            
            if (startDate > endDate) {
                alert('End date cannot be earlier than start date');
                endDateInput.value = '';
            }
        }
    });
</script>
{% endblock %}