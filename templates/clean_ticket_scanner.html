{% extends "base.html" %}

{% block title %}Ticket Scanner | Scan Your Lottery Ticket | Snap Lotto{% endblock %}

{% block meta_description %}Upload your lottery ticket and get instant results. The ONLY scanner with official Ithuba Lottery, PowerBall & Daily Lottery data. Free with no registration.{% endblock %}

{% block meta_keywords %}South Africa lottery ticket scanner, scan Lotto ticket South Africa, check lottery ticket South Africa, PowerBall ticket scanner, lottery scanner app, instant lottery check{% endblock %}

{% block og_title %}Scan Your Lottery Ticket | Instant Results | Snap Lotto{% endblock %}
{% block og_description %}Upload your lottery ticket and instantly check if you've won. The ONLY scanner with official Ithuba Lottery, PowerBall & Daily Lottery data.{% endblock %}

{% block additional_head %}
<!-- Minimal styling to ensure functionality -->
<style>
    /* Core styles for the ticket scanner functionality */
    .ticket-scanner-container {
        max-width: 800px;
        margin: 0 auto;
    }
    
    .ticket-drop-area {
        border: 2px dashed #aaa;
        border-radius: 8px;
        padding: 40px;
        text-align: center;
        background-color: rgba(0,0,0,0.05);
        cursor: pointer;
        transition: all 0.3s;
        margin-bottom: 20px;
    }
    
    .ticket-drop-area:hover, .ticket-drop-area.highlight {
        border-color: #f1c40f;
        background-color: rgba(0,0,0,0.1);
    }
    
    .preview-image {
        max-width: 100%;
        max-height: 300px;
        margin: 10px 0;
    }
    
    /* Ad overlay system */
    .ad-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }
    
    .ad-container {
        width: 100%;
        max-width: 600px;
        background-color: #fff;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        color: #000;
    }
    
    /* Button pulse animation */
    .btn-pulse {
        animation: button-pulse 1.5s infinite;
    }
    
    @keyframes button-pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }
    
    /* Mobile optimizations */
    @media (max-width: 576px) {
        .ticket-drop-area {
            padding: 20px;
        }
        
        .ad-container {
            max-width: 90%;
        }
    }
</style>

<!-- Core ticket scanner scripts -->
<script src="{{ url_for('static', filename='js/clean-file-uploader.js') }}" defer></script>
<script src="{{ url_for('static', filename='js/clean-ad-manager.js') }}" defer></script>
{% endblock %}

{% block content %}
<div class="container ticket-scanner-container my-4">
    <h1 class="text-center mb-3">Lottery Ticket Scanner</h1>
    
    <p class="lead text-center mb-4">
        Upload a photo of your lottery ticket to instantly check if you've won. Works with Lottery, PowerBall, and Daily Lottery tickets.
    </p>
    
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h2 class="h5 mb-0">Scan Your Ticket</h2>
        </div>
        
        <div class="card-body">
            <form id="ticket-form" action="/scan-ticket" method="post" enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                
                <!-- Lottery type selection (optional) -->
                <div class="mb-3">
                    <label for="lottery-type" class="form-label">Lottery Type (Optional - AI will detect)</label>
                    <select class="form-select" id="lottery-type" name="lottery_type">
                        <option value="">Auto-detect from ticket</option>
                        <option value="Lottery">Lottery</option>
                        <option value="Lottery Plus 1">Lottery Plus 1</option>
                        <option value="Lottery Plus 2">Lottery Plus 2</option>
                        <option value="Powerball">Powerball</option>
                        <option value="Powerball Plus">Powerball Plus</option>
                        <option value="Daily Lottery">Daily Lottery</option>
                    </select>
                </div>
                
                <!-- Optional draw number -->
                <div class="mb-3">
                    <label for="draw-number" class="form-label">Draw Number (Optional)</label>
                    <input type="text" class="form-control" id="draw-number" name="draw_number" placeholder="Leave blank to auto-detect">
                </div>
                
                <!-- File drop area and selection -->
                <div class="mb-3">
                    <div id="drop-area" class="ticket-drop-area">
                        <i class="fas fa-upload fa-2x mb-2"></i>
                        <p>Drop your ticket image here or click the button below</p>
                        <input type="file" id="ticket-image" name="ticket_image" accept="image/*" class="d-none">
                        <button type="button" id="file-select-btn" class="btn btn-primary">Select Image</button>
                    </div>
                </div>
                
                <!-- Image preview area (hidden until file selected) -->
                <div id="preview-container" class="text-center d-none">
                    <h5>Ticket Preview</h5>
                    <img id="ticket-preview" class="preview-image" src="" alt="Ticket preview">
                    <div class="mt-2">
                        <button type="button" id="remove-image" class="btn btn-outline-danger btn-sm">Remove Image</button>
                    </div>
                </div>
                
                <!-- Scan button -->
                <div class="text-center mt-3">
                    <button type="submit" id="scan-button" class="btn btn-success btn-lg" disabled>
                        <i class="fas fa-search"></i> Scan Ticket
                    </button>
                </div>
            </form>
            
            <!-- Loading indicator (hidden initially) -->
            <div id="scanner-loading" class="text-center py-4" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Scanning ticket...</p>
            </div>
            
            <!-- Results container (hidden initially) -->
            <div id="results-container" class="mt-4" style="display: none;">
                <!-- Results will be displayed here -->
            </div>
        </div>
        
        <div class="card-footer">
            <small class="text-muted">
                <i class="fas fa-shield-alt"></i> Your privacy is important to us. Images are processed securely and not stored after scanning.
            </small>
        </div>
    </div>
    
    <!-- Public Service Ad Overlay -->
    <div id="ad-overlay-loading" class="ad-overlay">
        <div id="ad-container-loader" class="ad-container">
            <h3>South Africa Responsible Gambling Foundation</h3>
            <p class="lead">Please gamble responsibly.</p>
            <p>If you or someone you know has a gambling problem, call the SARGF Helpline: 0800 006 008</p>
            <div class="countdown-container mt-3">
                <p>Advertisement will disappear in <span id="first-countdown">5</span> seconds</p>
            </div>
        </div>
    </div>
    
    <!-- Monetization Ad Overlay -->
    <div id="ad-overlay-results" class="ad-overlay">
        <div id="ad-container-interstitial" class="ad-container">
            <h3>Advertisement</h3>
            <p class="ad-content">
                <!-- Ad content would go here -->
                Try our premium lottery prediction service! Increase your chances of winning with our AI-powered number generator.
            </p>
            <div class="countdown-container mt-3">
                <p>Results will be available in <span id="countdown">15</span> seconds</p>
            </div>
            <div id="view-results-btn-container" class="mt-3">
                <button id="view-results-btn" class="btn btn-lg btn-success" disabled>
                    View Results Now!
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}