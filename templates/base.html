<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <!-- Consent Manager removed as requested -->
    
    <!-- Extra meta content for page-specific early loading scripts -->
    {% block extra_meta %}{% endblock %}
    
    <!-- Optimized Google Analytics - Defer loading -->
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-M4NREF90ZD');
      
      // Load GA script after page loads
      window.addEventListener('load', function() {
        var script = document.createElement('script');
        script.async = true;
        script.src = 'https://www.googletagmanager.com/gtag/js?id=G-M4NREF90ZD';
        document.head.appendChild(script);
      });
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>{% block title %}Snap Lotto{% endblock %}</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="{% block meta_description %}Snap Lotto - South Africa's #1 Lotto, Lottery, PowerBall & Daily Lotto Scanner App. The ONLY app with DIRECT access to Ithuba National Lottery database, Snap Scan and Win = Phanda Phusha Play{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}Snap Lotto, Lotto South Africa, SA Lotto, Lotto results, Lotto scanner, Lotto numbers, PowerBall South Africa, Daily Lotto, Ithuba National Lottery database, direct Ithuba data, official Lotto results, Lotto ticket scanner, Lotto winning numbers, SA Lotto Plus 1, SA Lotto Plus 2, Lotto draw results, South African Lotto{% endblock %}">
    <meta name="author" content="Snap Lotto">
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large">
    <meta name="language" content="English">
    <meta name="geo.region" content="ZA">
    <meta name="geo.placename" content="South Africa">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:title" content="{% block og_title %}Snap Lotto | South Africa's #1 Lotto, Lottery, PowerBall & Daily Lotto Scanner App{% endblock %}">
    <meta property="og:description" content="{% block og_description %}The ONLY app with DIRECT access to Ithuba National Lottery database, Snap Scan and Win = Phanda Phusha Play{% endblock %}">
    <meta property="og:image" content="{{ url_for('static', filename='img/snap-lotto-social.jpg', _external=True) }}">
    <meta property="og:locale" content="en_ZA">
    <meta property="og:site_name" content="Snap Lotto">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="{{ request.url }}">
    <meta property="twitter:title" content="{% block twitter_title %}Snap Lotto | South Africa's #1 Lotto, Lottery, PowerBall & Daily Lotto Scanner App{% endblock %}">
    <meta property="twitter:description" content="{% block twitter_description %}The ONLY app with DIRECT access to Ithuba National Lottery database, Snap Scan and Win = Phanda Phusha Play{% endblock %}">
    <meta property="twitter:image" content="{{ url_for('static', filename='img/snap-lotto-social.jpg', _external=True) }}">
    
    <!-- Canonical URL -->
    {% if request.path == '/ticket-scanner' or request.path == '/scanner-landing' %}
    <link rel="canonical" href="{{ url_for('scanner_landing', _external=True) }}">
    {% else %}
    <link rel="canonical" href="{{ request.url }}">
    {% endif %}
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Snap Lotto">
    <meta name="application-name" content="Snap Lotto">
    <meta name="msapplication-TileColor" content="#1a472a">
    <meta name="msapplication-TileImage" content="{{ url_for('static', filename='icons/icon-144x144.png') }}">
    <meta name="theme-color" content="#1a472a">
    <meta name="color-scheme" content="light">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    
    <!-- PWA Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='icons/icon-96x96.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='icons/icon-72x72.png') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='icons/icon-192x192.png') }}">
    <link rel="apple-touch-icon" sizes="152x152" href="{{ url_for('static', filename='icons/icon-152x152.png') }}">
    <link rel="apple-touch-icon" sizes="144x144" href="{{ url_for('static', filename='icons/icon-144x144.png') }}">
    <link rel="apple-touch-icon" sizes="120x120" href="{{ url_for('static', filename='icons/icon-128x128.png') }}">
    <link rel="apple-touch-icon" sizes="114x114" href="{{ url_for('static', filename='icons/icon-128x128.png') }}">
    <link rel="apple-touch-icon" sizes="76x76" href="{{ url_for('static', filename='icons/icon-96x96.png') }}">
    <link rel="apple-touch-icon" sizes="72x72" href="{{ url_for('static', filename='icons/icon-72x72.png') }}">
    <link rel="apple-touch-icon" sizes="60x60" href="{{ url_for('static', filename='icons/icon-72x72.png') }}">
    <link rel="apple-touch-icon" sizes="57x57" href="{{ url_for('static', filename='icons/icon-72x72.png') }}">
    
    <!-- Microsoft Windows/Edge -->
    <meta name="msapplication-config" content="{{ url_for('static', filename='browserconfig.xml') }}">
    <meta name="msapplication-navbutton-color" content="#1a472a">
    <meta name="msapplication-starturl" content="/">
    
    <!-- iOS Safari specific -->
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="{{ url_for('static', filename='css/custom.css') }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="{{ url_for('static', filename='css/lottery.css') }}?v=20250608" as="style" onload="this.onload=null;this.rel='stylesheet'">

    <link rel="preload" href="{{ url_for('static', filename='css/badge-fix.css') }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="{{ url_for('static', filename='css/dropdown-fix.css') }}" as="style" onload="this.onload=null;this.rel='stylesheet'">





    <link rel="preload" href="{{ url_for('static', filename='css/lottery-results-fix.css') }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="{{ url_for('static', filename='css/pwa-mobile.css') }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="{{ url_for('static', filename='css/mobile-charts.css') }}" as="style" onload="this.onload=null;this.rel='stylesheet'">

    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    
    <!-- Fallback for no-JS -->
    <noscript>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/lottery.css') }}?v=20250608">

        <link rel="stylesheet" href="{{ url_for('static', filename='css/badge-fix.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/dropdown-fix.css') }}">

        <link rel="stylesheet" href="{{ url_for('static', filename='css/lottery-results-fix.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/pwa-mobile.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/mobile-charts.css') }}">
    
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    </noscript>
    
    <!-- Bootstrap JS - Load immediately for dropdown functionality -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Bootstrap dropdown functionality for all dropdowns -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Wait a bit for Bootstrap to initialize
            setTimeout(function() {
                // Handle user dropdown (if exists)
                const userDropdown = document.getElementById('userDropdown');
                const userDropdownMenu = document.querySelector('#userDropdown + .dropdown-menu');
                
                if (userDropdown && userDropdownMenu) {
                    // Simple click handler for user dropdown
                    userDropdown.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // Toggle dropdown
                        if (userDropdownMenu.style.display === 'block') {
                            userDropdownMenu.style.display = 'none';
                            this.setAttribute('aria-expanded', 'false');
                        } else {
                            userDropdownMenu.style.display = 'block';
                            this.setAttribute('aria-expanded', 'true');
                            
                            // Position the dropdown
                            const rect = this.getBoundingClientRect();
                            userDropdownMenu.style.position = 'absolute';
                            userDropdownMenu.style.top = (rect.bottom - rect.top) + 'px';
                            userDropdownMenu.style.right = '0';
                        }
                    });
                    
                    // Close on click outside
                    document.addEventListener('click', function(e) {
                        if (!userDropdown.contains(e.target) && !userDropdownMenu.contains(e.target)) {
                            userDropdownMenu.style.display = 'none';
                            userDropdown.setAttribute('aria-expanded', 'false');
                        }
                    });
                    
                    // Close on item click
                    userDropdownMenu.querySelectorAll('.dropdown-item').forEach(function(item) {
                        item.addEventListener('click', function() {
                            userDropdownMenu.style.display = 'none';
                            userDropdown.setAttribute('aria-expanded', 'false');
                        });
                    });
                }

                // Handle data filter dropdown
                console.log('DROPDOWN DEBUG: Looking for data filter dropdown...');
                const dataFilterDropdown = document.getElementById('dataFilterDropdown');
                const dataFilterDropdownMenu = document.querySelector('#dataFilterDropdown + .dropdown-menu');
                console.log('DROPDOWN DEBUG: dataFilterDropdown:', dataFilterDropdown);
                console.log('DROPDOWN DEBUG: dataFilterDropdownMenu:', dataFilterDropdownMenu);
                
                if (dataFilterDropdown && dataFilterDropdownMenu) {
                    console.log('DROPDOWN DEBUG: Found data filter dropdown elements');
                    
                    // Try Bootstrap initialization first
                    if (window.bootstrap && window.bootstrap.Dropdown) {
                        try {
                            const bsDropdown = new window.bootstrap.Dropdown(dataFilterDropdown);
                            console.log('DROPDOWN DEBUG: Bootstrap dropdown initialized successfully');
                        } catch (error) {
                            console.warn('DROPDOWN DEBUG: Bootstrap initialization failed, using fallback:', error);
                            initializeCustomDropdown();
                        }
                    } else {
                        console.warn('DROPDOWN DEBUG: Bootstrap not available, using custom dropdown');
                        initializeCustomDropdown();
                    }
                    
                    function initializeCustomDropdown() {
                        console.log('DROPDOWN DEBUG: Initializing custom dropdown');
                        
                        // Simple click handler for filter dropdown
                        dataFilterDropdown.addEventListener('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            console.log('DROPDOWN DEBUG: Filter dropdown clicked');
                            
                            // Toggle dropdown visibility
                            const isOpen = dataFilterDropdownMenu.style.display === 'block';
                            
                            if (isOpen) {
                                dataFilterDropdownMenu.style.display = 'none';
                                this.setAttribute('aria-expanded', 'false');
                                this.classList.remove('show');
                                dataFilterDropdownMenu.classList.remove('show');
                                console.log('DROPDOWN DEBUG: Dropdown closed');
                            } else {
                                // Position the dropdown properly
                                const rect = this.getBoundingClientRect();
                                dataFilterDropdownMenu.style.position = 'absolute';
                                dataFilterDropdownMenu.style.top = (rect.height + 2) + 'px';
                                dataFilterDropdownMenu.style.right = '0';
                                dataFilterDropdownMenu.style.left = 'auto';
                                dataFilterDropdownMenu.style.zIndex = '1050';
                                dataFilterDropdownMenu.style.display = 'block';
                                
                                this.setAttribute('aria-expanded', 'true');
                                this.classList.add('show');
                                dataFilterDropdownMenu.classList.add('show');
                                console.log('DROPDOWN DEBUG: Dropdown opened');
                            }
                        });
                        
                        // Close on click outside
                        document.addEventListener('click', function(e) {
                            if (!dataFilterDropdown.contains(e.target) && !dataFilterDropdownMenu.contains(e.target)) {
                                dataFilterDropdownMenu.style.display = 'none';
                                dataFilterDropdown.setAttribute('aria-expanded', 'false');
                                dataFilterDropdown.classList.remove('show');
                                dataFilterDropdownMenu.classList.remove('show');
                            }
                        });
                        
                        // Handle filter selection
                        dataFilterDropdownMenu.querySelectorAll('.dropdown-item').forEach(function(item) {
                            item.addEventListener('click', function(e) {
                                e.preventDefault();
                                console.log('DROPDOWN DEBUG: Filter item clicked:', this.textContent);
                                
                                // Remove active class from siblings
                                const isLotteryType = this.hasAttribute('data-lottery-type');
                                const isTimePeriod = this.hasAttribute('data-time-period');
                                
                                if (isLotteryType) {
                                    dataFilterDropdownMenu.querySelectorAll('[data-lottery-type]').forEach(el => el.classList.remove('active'));
                                    this.classList.add('active');
                                } else if (isTimePeriod) {
                                    dataFilterDropdownMenu.querySelectorAll('[data-time-period]').forEach(el => el.classList.remove('active'));
                                    this.classList.add('active');
                                }
                                
                                // Close dropdown after selection
                                dataFilterDropdownMenu.style.display = 'none';
                                dataFilterDropdown.setAttribute('aria-expanded', 'false');
                                dataFilterDropdown.classList.remove('show');
                                dataFilterDropdownMenu.classList.remove('show');
                            });
                        });
                    }
                } else {
                    console.warn('DROPDOWN DEBUG: Data filter dropdown elements not found on this page');
                }

                // Also add a global click handler for any dropdown buttons as additional fallback
                document.addEventListener('click', function(e) {
                    if (e.target.id === 'dataFilterDropdown' || e.target.closest('#dataFilterDropdown')) {
                        console.log('DROPDOWN DEBUG: Manual click detected on filter button');
                        const button = e.target.id === 'dataFilterDropdown' ? e.target : e.target.closest('#dataFilterDropdown');
                        const menu = button.nextElementSibling;
                        
                        if (menu && menu.classList.contains('dropdown-menu')) {
                            e.preventDefault();
                            e.stopPropagation();
                            console.log('DROPDOWN DEBUG: Manual dropdown toggle');
                            
                            if (menu.style.display === 'block' || menu.classList.contains('show')) {
                                menu.style.display = 'none';
                                menu.classList.remove('show');
                                button.setAttribute('aria-expanded', 'false');
                            } else {
                                menu.style.display = 'block';
                                menu.classList.add('show');
                                button.setAttribute('aria-expanded', 'true');
                            }
                        }
                    }
                });
            } else {
                console.warn('DROPDOWN DEBUG: Data filter dropdown elements not found on this page');
            }
            }, 500); // Longer delay to ensure all HTML is rendered
        });
    </script>
    <!-- Mobile optimization -->
    <meta name="format-detection" content="telephone=no">
    <!-- Content Security Policy with needed permissions -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https://www.googletagmanager.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; font-src 'self' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; img-src 'self' data:;">
    
    {% if config.get('ENVIRONMENT') == 'production' %}
    <!-- Google AdSense - Only loaded in production environment -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3172540139156466" crossorigin="anonymous"></script>
    {% endif %}
    
    {% block additional_head %}{% endblock %}
    {% block head_content %}{% endblock %}
</head>
<body class="{% block body_class %}{% endblock %}">
    <nav class="navbar navbar-expand-lg mb-2 sticky-top">
        <div class="container-fluid px-2">
            <a class="navbar-brand" href="/">
                <div class="lottery-logo">
                    <i class="fas fa-bolt" style="font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important; font-weight: 900 !important; visibility: visible !important; display: inline-block !important; opacity: 1 !important;"></i>
                    <span class="d-none d-sm-inline">SNAP LOTTO</span>
                    <span class="d-inline d-sm-none">SL</span>
                </div>
            </a>
            <!-- Mobile navigation handled by bottom nav bar, desktop navigation shown directly -->
            <div class="d-none d-lg-flex w-100 justify-content-between align-items-center" id="navbarNav">
                <ul class="navbar-nav d-flex flex-row">
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center py-2 px-2" href="/"><i class="fas fa-home me-1" style="font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important; font-weight: 900 !important; visibility: visible !important; display: inline-block !important; opacity: 1 !important;"></i> Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center py-2 px-2" href="/results"><i class="fas fa-list-ol me-1" style="font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important; font-weight: 900 !important; visibility: visible !important; display: inline-block !important; opacity: 1 !important;"></i> Results</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center py-2 px-2" href="/guides"><i class="fas fa-book me-1" style="font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important; font-weight: 900 !important; visibility: visible !important; display: inline-block !important; opacity: 1 !important;"></i> Guides</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center py-2 px-2" href="/visualizations"><i class="fas fa-chart-bar me-1" style="font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important; font-weight: 900 !important; visibility: visible !important; display: inline-block !important; opacity: 1 !important;"></i> Analytics</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center py-2 px-2 {% if request.path == '/ticket-scanner' or request.path == '/scan-lottery-ticket-south-africa' or request.path == '/scanner-landing' %}active{% endif %}" href="/scanner-landing"><i class="fas fa-ticket-alt me-1" style="font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', FontAwesome !important; font-weight: 900 !important; visibility: visible !important; display: inline-block !important; opacity: 1 !important;"></i> Scanner</a>
                    </li>

                </ul>
                <ul class="navbar-nav flex-shrink-0">
                    {% if current_user.is_authenticated %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle d-flex align-items-center py-2 px-2" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-user-circle me-1"></i> {{ current_user.username }}
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                                {% if current_user.is_admin %}
                                <li><a class="dropdown-item" href="{{ url_for('admin') }}"><i class="fas fa-shield-alt me-2"></i> Admin Dashboard</a></li>
                                <li><a class="dropdown-item" href="/predictions"><i class="fas fa-brain me-2"></i> AI Predictions</a></li>
                                <li><hr class="dropdown-divider"></li>
                                {% endif %}
                                <li><a class="dropdown-item" href="/logout"><i class="fas fa-sign-out-alt me-2"></i> Logout</a></li>
                            </ul>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link btn btn-outline-primary px-3 py-1" href="{{ url_for('login') }}">
                                <i class="fas fa-sign-in-alt me-1"></i> Login
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <!-- Ad containers for loader and interstitial ads -->
    <div id="ad-container-loader" style="display: none;"></div>
    <div id="ad-container-interstitial" style="display: none;"></div>
    
    <div class="{% block container_class %}container{% endblock %} px-2 px-sm-3">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show mb-2">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Breadcrumb navigation with schema.org markup -->
        {% if breadcrumbs is defined and breadcrumbs %}
        <nav aria-label="breadcrumb" class="mb-3">
            <ol class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
                <li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                    <a href="/" itemprop="item"><span itemprop="name">Home</span></a>
                    <meta itemprop="position" content="1" />
                </li>
                {% for breadcrumb in breadcrumbs %}
                    <li class="breadcrumb-item {% if loop.last %}active{% endif %}" 
                        itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                        {% if not loop.last %}
                            <a href="{{ breadcrumb.url }}" itemprop="item">
                                <span itemprop="name">{{ breadcrumb.name }}</span>
                            </a>
                        {% else %}
                            <span itemprop="name">{{ breadcrumb.name }}</span>
                        {% endif %}
                        <meta itemprop="position" content="{{ loop.index + 1 }}" />
                    </li>
                {% endfor %}
            </ol>
        </nav>
        {% endif %}

        {% block content %}{% endblock %}
    </div>

    <footer class="footer mt-4 py-3">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-3 mb-md-0">
                    <h5 class="h6 mb-2">Snap Lotto</h5>
                    <p class="small mb-2">South Africa's #1 Lottery, PowerBall & Daily Lottery Scanner App. The ONLY app with official Ithuba Lottery, PowerBall & Daily Lottery data, Snap Scan and Win = Phanda Phusha Play</p>
                    <p class="small">&copy; 2025 Snap Lotto</p>
                </div>
                <div class="col-md-3 mb-3 mb-md-0">
                    <h5 class="h6 mb-2">Lottery Games</h5>
                    <ul class="list-unstyled small">
                        <li><a href="/results?game=Lotto" class="text-decoration-none">SA Lotto Results</a></li>
                        <li><a href="/results?game=Powerball" class="text-decoration-none">PowerBall Results</a></li>
                        <li><a href="/results?game=Daily+Lotto" class="text-decoration-none">Daily Lotto Results</a></li>
                        <li><a href="/visualizations" class="text-decoration-none">Lottery Analysis</a></li>
                    </ul>
                </div>
                <div class="col-md-3 mb-3 mb-md-0">
                    <h5 class="h6 mb-2">Quick Links</h5>
                    <ul class="list-unstyled small">
                        <li><a href="/scanner-landing" class="text-decoration-none">Scan Your Ticket</a></li>
                        <li><a href="/guides/how-to-play-lotto" class="text-decoration-none">How to Play Lotto</a></li>
                        <li><a href="/guides/how-to-play-powerball" class="text-decoration-none">How to Play PowerBall</a></li>
                        <li><a href="/guides/how-to-play-daily-lotto" class="text-decoration-none">How to Play Daily Lotto</a></li>
                    </ul>
                </div>
                <div class="col-md-2">
                    <h5 class="h6 mb-2">Connect</h5>
                    <p class="small mb-2"><a href="https://www.snaplotto.co.za" class="text-decoration-none" target="_blank">www.snaplotto.co.za</a></p>
                    <div class="d-flex gap-2">
                        <a href="#" class="text-decoration-none" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="text-decoration-none" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-decoration-none" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Mobile navigation (only on mobile) -->
    <style>
    /* Mobile navigation - force fixed positioning */
    #mobile-nav {
        position: fixed !important;
        bottom: 0 !important;
        left: 0 !important;
        right: 0 !important;
        width: 100% !important;
        height: 60px !important;
        background: white !important;
        border-top: 1px solid #ddd !important;
        box-shadow: 0 -2px 4px rgba(0,0,0,0.1) !important;
        z-index: 9999 !important;
        display: flex !important;
    }
    
    #mobile-nav a {
        flex: 1 !important;
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        justify-content: center !important;
        color: #666 !important;
        text-decoration: none !important;
        font-size: 10px !important;
        padding: 4px !important;
    }
    
    #mobile-nav a i {
        font-size: 16px !important;
        margin-bottom: 2px !important;
    }
    
    #mobile-nav a.active {
        color: #dc3545 !important;
    }
    
    /* Add bottom padding to body on mobile */
    @media (max-width: 991px) {
        body { 
            padding-bottom: 70px !important; 
            margin-bottom: 0 !important;
        }
    }
    
    /* Hide on desktop */
    @media (min-width: 992px) {
        #mobile-nav { 
            display: none !important; 
        }
        body {
            padding-bottom: 0 !important;
        }
    }
    </style>
    
    <!-- Simple Mobile Navigation -->
    <div style="position: fixed; bottom: 0; left: 0; right: 0; height: 60px; background: white; border-top: 1px solid #ddd; z-index: 999999; display: flex;" class="d-lg-none">
        <a href="/" style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; text-decoration: none; color: {% if request.path == '/' %}#dc3545{% else %}#666{% endif %};">
            <i class="fas fa-home" style="font-size: 16px; margin-bottom: 2px;"></i>
            <small>Home</small>
        </a>
        <a href="/results" style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; text-decoration: none; color: {% if request.path == '/results' %}#dc3545{% else %}#666{% endif %};">
            <i class="fas fa-list-ol" style="font-size: 16px; margin-bottom: 2px;"></i>
            <small>Results</small>
        </a>
        <a href="/guides" style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; text-decoration: none; color: {% if request.path.startswith('/guides') %}#dc3545{% else %}#666{% endif %};">
            <i class="fas fa-book" style="font-size: 16px; margin-bottom: 2px;"></i>
            <small>Guides</small>
        </a>
        <a href="/scanner-landing" style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; text-decoration: none; color: {% if request.path in ['/ticket-scanner', '/scan-lottery-ticket-south-africa', '/scanner-landing'] %}#dc3545{% else %}#666{% endif %};">
            <i class="fas fa-ticket-alt" style="font-size: 16px; margin-bottom: 2px;"></i>
            <small>Scanner</small>
        </a>
        <a href="/visualizations" style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; text-decoration: none; color: {% if request.path == '/visualizations' %}#dc3545{% else %}#666{% endif %};">
            <i class="fas fa-chart-bar" style="font-size: 14px; margin-bottom: 2px;"></i>
            <small style="font-size: 11px;">Analytics</small>
        </a>
        {% if current_user.is_authenticated and current_user.is_admin %}
        <a href="/predictions" style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; text-decoration: none; color: {% if request.path == '/predictions' %}#dc3545{% else %}#666{% endif %};">
            <i class="fas fa-brain" style="font-size: 14px; margin-bottom: 2px;"></i>
            <small style="font-size: 11px;">AI</small>
        </a>
        {% endif %}
        {% if current_user.is_authenticated and current_user.is_admin %}
        <a href="{{ url_for('admin') }}" style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; text-decoration: none; color: {% if request.path == '/admin' %}#dc3545{% else %}#666{% endif %};">
            <i class="fas fa-shield-alt" style="font-size: 16px; margin-bottom: 2px;"></i>
            <small>Admin</small>
        </a>
        {% endif %}
    </div>
    
    <!-- PWA Install Button -->
    <button id="pwa-install-btn" type="button">
        <i class="fas fa-download"></i>
        Install App
    </button>
    
    <style>
    @media (max-width: 991px) {
        body { padding-bottom: 70px; }
    }
    </style>

    <!-- Bootstrap JavaScript Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    


    {% block scripts %}{% endblock %}
    {% block additional_scripts %}{% endblock %}
    <!-- Ad scripts have been replaced with stubs that maintain compatibility but don't show ads -->
    <script src="{{ url_for('static', filename='js/ads.js') }}"></script>
    <!-- Dedicated dropdown fix for filter button -->
    <script src="{{ url_for('static', filename='js/dropdown-fix.js') }}"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // Register service worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/static/sw.js')
                    .then(function(registration) {
                        console.log('Snap Lotto SW: Service worker registered successfully:', registration.scope);
                        
                        // Check for updates periodically
                        setInterval(function() {
                            registration.update();
                        }, 60000); // Check every minute
                        
                    })
                    .catch(function(error) {
                        console.log('Snap Lotto SW: Service worker registration failed:', error);
                    });
            });
        }
        
        // Install prompt for PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', function(e) {
            console.log('Snap Lotto PWA: Install prompt available');
            e.preventDefault();
            deferredPrompt = e;
            
            // Show custom install button if needed
            const installButton = document.getElementById('pwa-install-btn');
            if (installButton) {
                installButton.style.display = 'block';
                installButton.addEventListener('click', function() {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then(function(choiceResult) {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('Snap Lotto PWA: User accepted the install prompt');
                        } else {
                            console.log('Snap Lotto PWA: User dismissed the install prompt');
                        }
                        deferredPrompt = null;
                        installButton.style.display = 'none';
                    });
                });
            }
        });
        
        // PWA installed event
        window.addEventListener('appinstalled', function(evt) {
            console.log('Snap Lotto PWA: App was installed successfully');
            
            // Hide install button if visible
            const installButton = document.getElementById('pwa-install-btn');
            if (installButton) {
                installButton.style.display = 'none';
            }
        });
        
        // iOS Safari standalone mode detection
        if (window.navigator.standalone === true) {
            console.log('Snap Lotto PWA: Running in iOS standalone mode');
            document.body.classList.add('ios-standalone');
        }
        
        // Android Chrome standalone mode detection
        if (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) {
            console.log('Snap Lotto PWA: Running in Android standalone mode');
            document.body.classList.add('android-standalone');
        }
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Force light theme on all tables and rows
            const tables = document.querySelectorAll('.table, .table-lottery');
            tables.forEach(table => {
                table.style.backgroundColor = '#fff';
                table.style.color = '#000';
                
                const rows = table.querySelectorAll('tr');
                rows.forEach(row => {
                    row.style.backgroundColor = '#fff';
                    row.style.color = '#000';
                    
                    const cells = row.querySelectorAll('td, th');
                    cells.forEach(cell => {
                        cell.style.color = '#000';
                    });
                });
                
                // Make even rows light gray
                const evenRows = table.querySelectorAll('tr:nth-child(even)');
                evenRows.forEach(row => {
                    row.style.backgroundColor = '#f9f9f9';
                });
            });
            
            // Remove the lottery data dashboard section
            setTimeout(() => {
                const headings = document.querySelectorAll('h4');
                for (let heading of headings) {
                    if (heading.textContent.includes('LOTTERY DATA DASHBOARD')) {
                        // Find the parent card element and remove it
                        let element = heading;
                        // Go up to find the card div (up to 5 parent levels)
                        for (let i = 0; i < 5; i++) {
                            if (element.parentElement) {
                                element = element.parentElement;
                                if (element.classList.contains('card')) {
                                    console.log('Found the dashboard card, removing it');
                                    element.remove();
                                    break;
                                }
                            }
                        }
                    }
                }
            }, 100);
        });
    </script>
    
    <!-- Mobile Performance Optimization Scripts -->
    <script src="{{ url_for('static', filename='js/mobile-optimized.js') }}" defer></script>
    
    {% block page_scripts %}{% endblock %}
</body>
</html>